<section id="media" class="media-gallery-section">
  <div class="container">
    <!-- Judul Bagian -->
    <h2 class="section-title">{{ languageService.getTranslation('mediaSectionTitle') | async }}</h2>

    <div class="gallery-filters">
      <!-- Loop melalui filters$ (Observable) -->
      <button
        *ngFor="let filter of (filters$ | async)"
        class="filter-btn"
        [class.active]="activeFilter === filter.value"
        (click)="setFilter(filter.value)">
        {{ filter.label }}
      </button>
    </div>

    <!-- Pesan jika tidak ada item ditemukan -->
    <div *ngIf="filteredMediaItems.length === 0" class="no-items-message">
      {{ languageService.getTranslation('noMediaItemsFound') | async }}
    </div>

    <div class="media-grid" @galleryAnimation>
      <!-- Gunakan displayedMediaItems untuk loop -->
      <div *ngFor="let item of displayedMediaItems; let i = index"
           class="media-card"
           tabindex="0"
           (click)="openMediaModal(item)">
        <div class="media-thumbnail">
           <ng-container [ngSwitch]="item.type">
             <img
               *ngSwitchCase="'image'"
               [ngSrc]="item.thumbnailUrl || item.url || 'assets/placeholder-image.jpg'"
               [alt]="getTranslatedText(item.title)"
               width="400"
               height="300"
               loading="lazy"
               class="thumbnail-image"
             />
             <div *ngSwitchCase="'video'" class="thumbnail-video-container">
                <img
                  [ngSrc]="item.thumbnailUrl || 'assets/placeholder-video.jpg'"
                  [alt]="getTranslatedText(item.title) + ' Thumbnail'"
                  width="400"
                  height="300"
                  loading="lazy"
                  class="thumbnail-image"
                />
                 <div class="play-icon-overlay">
                    <fa-icon [icon]="item.videoProvider === 'youtube' ? faYoutube : item.videoProvider === 'tiktok' ? faTiktok : faInstagram"></fa-icon>
                 </div>
             </div>
           </ng-container>
        </div>

        <div class="media-info">
           <h3 class="media-title">{{ getTranslatedText(item.title) }}</h3>
           <p class="media-year">{{ item.year }}</p>
        </div>
      </div>
    </div>

    <!-- Tombol "Show More" -->
    <div class="show-more-container" *ngIf="canShowMore">
      <button class="btn btn-primary show-more-btn" (click)="loadMoreItems()">
        {{ languageService.getTranslation('showMoreButtonLabel') | async }}
      </button>
    </div>

  </div>

  <!-- === Modal Media Viewer (Internal) === -->
  <div class="modal-overlay" *ngIf="isModalOpen" (click)="closeMediaModal()" @modalAnimation>
    <div class="modal-content" (click)="$event.stopPropagation()">
      <div *ngIf="selectedMediaItem" class="media-viewer-content">

         <div class="viewer-media-area">
           <ng-container [ngSwitch]="selectedMediaItem.type">
             <img
               *ngSwitchCase="'image'"
               [ngSrc]="selectedMediaItem.url || 'assets/placeholder-image.jpg'"
               [alt]="getTranslatedText(selectedMediaItem.title)"
               loading="eager"
               class="viewer-image"
               width="1000"
               height="800"
             />
             <div *ngSwitchCase="'video'" class="viewer-video-container">
               <iframe
                 *ngIf="getSafeVideoEmbedUrl(selectedMediaItem) as videoUrl"
                 [src]="videoUrl"
                 frameborder="0"
                 allow="accelerometer; autoplay; clipboard-write; encrypted-m        edia; gyroscope; picture-in-picture; web-share"
                 allowfullscreen
                 class="viewer-video">
               </iframe>
               <p *ngIf="!getSafeVideoEmbedUrl(selectedMediaItem)" class="error-message">{{ languageService.getTranslation('videoLoadError') | async }}</p>
             </div>
           </ng-container>
         </div>

         <div class="viewer-info-area">
           <h3 class="viewer-title">{{ getTranslatedText(selectedMediaItem.title) }}</h3>
           <p class="viewer-year">{{ selectedMediaItem.year }}</p>
           <p class="viewer-description" *ngIf="selectedMediaItem.description">
             {{ getTranslatedText(selectedMediaItem.description) }}
           </p>
         </div>

         <div class="viewer-navigation">
            <button
              *ngIf="hasPrevious"
              class="nav-btn prev"
              (click)="showPrevious()"
              [attr.aria-label]="(languageService.getTranslation('previousMediaLabel') | async)">
              <fa-icon [icon]="faChevronLeft"></fa-icon>
            </button>
            <button
              *ngIf="hasNext"
              class="nav-btn next"
              (click)="showNext()"
              [attr.aria-label]="(languageService.getTranslation('nextMediaLabel') | async)">
              <fa-icon [icon]="faChevronRight"></fa-icon>
            </button>
          </div>
           <button class="close-button" (click)="closeMediaModal()" [attr.aria-label]="languageService.getTranslation('closeModalButton') | async">
             <fa-icon [icon]="faTimes"></fa-icon>
           </button>
     </div>
    </div>
  </div>
</section>
